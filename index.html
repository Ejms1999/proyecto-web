<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8">
  <title>Custom20 | Inicio</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <!-- Bootstrap -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css" rel="stylesheet">
  <!-- Custom20 Styles -->
  <link href="assets/css/styles.css" rel="stylesheet">
  
  <!-- Nuevos colores específicos para scooters (sin cambiar estructura) -->
  <style>
    :root {
      --scooter-orange: #FF6B35;
      --scooter-blue: #2E86AB; 
      --scooter-dark: #1a1a1a;
      --scooter-success: #28A745;
      --scooter-warning: #FFC107;
    }

    /* Reemplazar colores Bootstrap primary por los colores scooter */
    .bg-primary {
      background-color: var(--scooter-orange) !important;
    }
    
    .btn-primary {
      background-color: var(--scooter-orange);
      border-color: var(--scooter-orange);
    }
    
    .btn-primary:hover {
      background-color: #e55a2b;
      border-color: #e55a2b;
    }
    
    .btn-outline-primary {
      color: var(--scooter-orange);
      border-color: var(--scooter-orange);
    }
    
    .btn-outline-primary:hover {
      background-color: var(--scooter-orange);
      border-color: var(--scooter-orange);
    }
    
    .text-primary {
      color: var(--scooter-orange) !important;
    }
    
    .badge.bg-primary {
      background-color: var(--scooter-blue) !important;
    }

    /* Añadir efectos hover a las service-cards */
    .service-card {
      transition: all 0.3s ease;
      padding: 1.5rem;
      border-radius: 10px;
      background: linear-gradient(135deg, rgba(255, 107, 53, 0.1), rgba(46, 134, 171, 0.1));
      border: 1px solid rgba(255, 107, 53, 0.2);
      height: 100%;
    }
    
    .service-card:hover {
      transform: translateY(-5px);
      box-shadow: 0 10px 25px rgba(255, 107, 53, 0.2);
      border-color: var(--scooter-orange);
    }
    
    .service-card .icon {
      color: var(--scooter-orange);
      font-size: 2rem;
      margin-bottom: 1rem;
    }

    /* ScooterPoints en navbar */
    .scooter-points {
      background: linear-gradient(135deg, var(--scooter-orange), var(--scooter-blue));
      color: white;
      padding: 0.5rem 1rem;
      border-radius: 20px;
      margin-right: 1rem;
      font-size: 0.9rem;
      font-weight: 500;
    }

    /* Navbar brand con gradiente */
    .navbar-brand {
      background: linear-gradient(45deg, var(--scooter-orange), var(--scooter-blue));
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }

    /* Header con gradiente */
    header.bg-primary {
      background: linear-gradient(135deg, var(--scooter-orange), var(--scooter-blue)) !important;
    }
  </style>
</head>
<body>
  <!-- Navbar con respaldo -->
  <nav class="navbar navbar-expand-lg bg-white border-bottom sticky-top">
    <div class="container">
      <a class="navbar-brand fw-bold" href="index.html"><i class="bi bi-scooter"></i> Custom20.cl</a>
      
      <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#mainNav">
        <span class="navbar-toggler-icon"></span>
      </button>

      <div class="collapse navbar-collapse" id="mainNav">
        <ul class="navbar-nav me-auto">
          <li class="nav-item admin-only d-none"><a class="nav-link" href="admin.html">Admin Productos</a></li>
          <li class="nav-item admin-only d-none"><a class="nav-link" href="admin_usuarios.html">Admin Usuarios</a></li>
          <li class="nav-item"><a class="nav-link" href="index.html"><i class="bi bi-house"></i> Inicio</a></li>
          <li class="nav-item"><a class="nav-link" href="productos.html">Repuestos</a></li>
          <li class="nav-item"><a class="nav-link" href="servicios.html">Servicios</a></li>
          <li class="nav-item"><a class="nav-link" href="preguntas.html">Preguntas</a></li>
          <li class="nav-item"><a class="nav-link" href="contacto.html">Contacto</a></li>
        </ul>

        
        <ul class="navbar-nav ms-auto">
          <!-- ScooterPoints (solo visible cuando hay usuario logueado) -->
          <li class="nav-item d-none me-2" id="scooterPointsSection">
            <span class="scooter-points">
              <i class="bi bi-trophy"></i> Nivel: <span id="user-tier">Beginner</span> | 
              <i class="bi bi-star"></i> <span id="user-points">0</span> pts
            </span>
          </li>
          
          <li class="nav-item me-3">
            <a class="nav-link position-relative" href="carrito.html">
              <i class="bi bi-cart"></i> Carrito
              <span id="cartCount" class="badge bg-primary text-white position-absolute top-0 start-100 translate-middle">0</span>
            </a>
          </li>
          <li class="nav-item" id="loginSection">
            <a class="btn btn-outline-primary btn-sm" href="login.html">
              <i class="bi bi-box-arrow-in-right me-1"></i>Iniciar Sesión
            </a>
          </li>
          <li class="nav-item d-none" id="userSection">
            <span class="navbar-text me-2" id="navUserName">Invitado</span>
            <a class="btn btn-outline-secondary btn-sm" href="#" id="btnLogout">
              <i class="bi bi-box-arrow-right me-1"></i>Salir
            </a>
          </li>
        </ul>
      </div>
    </div>
  </nav>
  <style>
  /* Colores personalizados para los títulos de cada slide */
  #heroCarousel .carousel-item:nth-child(1) h2 { color: #00FFAA; } 
  #heroCarousel .carousel-item:nth-child(2) h2 { color: #c64364; } 
  #heroCarousel .carousel-item:nth-child(3) h2 { color: #c9f734; } 

  /* Mejora la legibilidad del texto sobre las imágenes */
  #heroCarousel .carousel-caption h2,
  #heroCarousel .carousel-caption p {
    text-shadow: 0 2px 8px rgba(8, 8, 8, 0.7);
  }
</style>

<div id="navbar-container" style="display: none;"></div>

<div id="heroCarousel" class="carousel slide" data-bs-ride="carousel" data-bs-interval="1999" data-bs-pause="false">
  <div class="carousel-inner">
    <!-- Slide 1 -->
    <div class="carousel-item active position-relative">
      <a href="servicios.html">
        <img src="Imagenes/servicio.JPEG" class="d-block w-100" alt="Servicio">
      </a>
      <div class="carousel-caption d-block">
        <a href="servicios.html" class="text-decoration-none">
          <h2 class="fw-bold">Nuestros Servicios</h2>
        </a>
      </div>
    </div>

    <!-- Slide 2 -->
    <div class="carousel-item position-relative">
      <a href="productos.html">
        <img src="Imagenes/producto.JPEG"class ="d-block w-100" alt="Producto">
      </a>
      <div class="carousel-caption d-block">
        <a href="productos.html" class="text-decoration-none">
          <h2 class="fw-bold">Respuestos y accesorios</h2>
        </a>
      </div>
    </div>

    <!-- Slide 3 -->
    <div class="carousel-item position-relative">
      <a href="contacto.html">
        <img src="Imagenes/contacto.JPEG" class="d-block w-100" alt="Contacto">
      </a>
      <div class="carousel-caption d-block">
        <a href="contacto.html" class="text-decoration-none">
          <h2 class="fw-bold">Contacto</h2>
        </a>
      </div>
    </div>
  <!-- Controles -->
  <button class="carousel-control-prev" type="button" data-bs-target="#heroCarousel" data-bs-slide="prev">
    <span class="carousel-control-prev-icon"></span>
  </button>
  <button class="carousel-control-next" type="button" data-bs-target="#heroCarousel" data-bs-slide="next">
    <span class="carousel-control-next-icon"></span>
  </button>
</div>


  <header class="bg-primary text-white text-center py-5">
    <div class="container">
      <h1 class="fw-bold">Reparación, repuestos, accesorios y baterías de litio a medida</h1>
      <p class="lead">Scooters eléctricos, bicicletas eléctricas y proyectos eléctricos</p>
      <div class="d-flex justify-content-center gap-2 flex-wrap">
        <a href="productos.html" class="btn btn-light text-primary"><i class="bi bi-bag me-1"></i>Ver repuestos</a>
        <a href="servicios.html" class="btn btn-outline-light"><i class="bi bi-tools me-1"></i>Servicios</a>
        <a href="login.html" class="btn btn-warning"><i class="bi bi-star me-1"></i>Únete y gana ScooterPoints</a>
      </div>
    </div>
  </header>

  
  <main class="container my-5">
    <section class="welcome-section">
      <header>
        <h2 class="h4 mb-3">Bienvenido a Custom20</h2>
      </header>
      <article class="about-content">
        <p class="lead"><i class="bi bi-battery-charging text-primary"></i> Con más de 6 años de experiencia en electromovilidad nos respaldan.</p>
        <p>Ofrecemos reparación y fabricación de baterías de litio a medida, mantención y diagnóstico eléctrico de scooters y bicicletas, además de la venta de repuestos y accesorios de calidad.</p>
        <p>Nuestro compromiso es brindarte seguridad, rendimiento y confianza en cada servicio, con garantía y soporte personalizado.</p>
        
        <!-- Nueva sección: ScooterPoints -->
        <div class="alert" style="background: linear-gradient(135deg, rgba(255, 107, 53, 0.1), rgba(46, 134, 171, 0.1)); border: 1px solid var(--scooter-orange);">
          <h5 class="text-primary"><i class="bi bi-trophy"></i> Sistema ScooterPoints</h5>
          <p class="mb-2">¡Gana puntos con cada compra y canjéalos por descuentos!</p>
          <ul class="list-unstyled mb-0">
            <li><i class="bi bi-check-circle text-success"></i> 1 punto por cada $1.000 gastado</li>
            <li><i class="bi bi-check-circle text-success"></i> 50 puntos extra por referir talleres</li>
            <li><i class="bi bi-check-circle text-success"></i> Niveles: Beginner → Advanced → Expert → Pro</li>
            <li><i class="bi bi-check-circle text-success"></i> Descuentos especiales para talleres registrados</li>
          </ul>
        </div>
      </article>
    </section>

    <section class="services-preview mt-5">
      <header>
        <h2 class="h4 mb-4">Nuestros Servicios</h2>
      </header>
      <div class="row g-4">
        <article class="col-md-4">
          <div class="service-card position-relative">
          <h3 class="h5">
            <i class="bi bi-battery-half icon"></i>
            Reparación de Baterías
          </h3>
          <p>Diagnóstico y reparación de baterías de litio de todo tipo de dispositivos eléctricos.</p>
          <small class="text-muted">Desde $25.000 | +25 ScooterPoints</small>

          <a href="servicios.html" class="stretched-link" aria-label="Ir a Servicios"></a>
        </div>
        </article>
        <article class="col-md-4">
          <div class="service-card position-relative">
          <h3 class="h5">
            <i class="bi bi-battery-half icon"></i>
            Reparación de Baterías
          </h3>
          <p>Diagnóstico y reparación de baterías de litio de todo tipo de dispositivos eléctricos.</p>
          <small class="text-muted">Desde $25.000 | +25 ScooterPoints</small>

          <a href="servicios.html" class="stretched-link" aria-label="Ir a Servicios"></a>
        </div>
        </article>
        <article class="col-md-4">
              <div class="service-card position-relative">
      <h3 class="h5">
        <i class="bi bi-lightning icon"></i>
        Diagnóstico Eléctrico
      </h3>
      <p>Servicio de fallas eléctricas de bicicletas, motos o scooters eléctricos.</p>
      <small class="text-muted">Desde $15.000 | +15 ScooterPoints</small>

      <a href="servicios.html" class="stretched-link" aria-label="Ir a Servicios"></a>
    </div>
        </article>
      </div>
    </section>

    <!-- Nueva sección: Productos Destacados -->
    <section class="featured-products mt-5">
      <header>
        <h2 class="h4 mb-4"><i class="bi bi-star-fill text-warning"></i> Productos Más Vendidos</h2>
      </header>
        <div class="row g-4">
        <article class="col-md-4">
        <div class="card h-100 position-relative">
          <div class="card-body">
            <div class="d-flex justify-content-between align-items-start mb-2">
              <span class="badge bg-success">En Stock</span>
              <small class="text-primary">+25 pts</small>
            </div>
            <h5 class="card-title">Batería Litio 36V 10Ah</h5>
            <p class="card-text">Compatible con la mayoría de scooters eléctricos</p>
            <div class="d-flex justify-content-between align-items-center">
              <strong class="h5 text-primary mb-0">$185.000</strong>
            </div>
            <a href="productos.html" class="stretched-link" aria-label="Ir a Productos: Batería 36V 10Ah"></a>
          </div>
        </div>
      </article>

      <article class="col-md-4">
        <div class="card h-100 position-relative">
          <div class="card-body">
            <div class="d-flex justify-content-between align-items-start mb-2">
              <span class="badge bg-warning text-dark">Pocas unidades</span>
              <small class="text-primary">+15 pts</small>
            </div>
            <h5 class="card-title">Cargador 42V 2A</h5>
            <p class="card-text">Cargador universal para baterías 36V</p>
            <div class="d-flex justify-content-between align-items-center">
              <strong class="h5 text-primary mb-0">$35.000</strong>
            </div>
            <a href="productos.html" class="stretched-link" aria-label="Ir a Productos: Cargador 42V 2A"></a>
          </div>
        </div>
      </article>

      <article class="col-md-4">
        <div class="card h-100 position-relative">
          <div class="card-body">
            <div class="d-flex justify-content-between align-items-start mb-2">
              <span class="badge bg-success">En Stock</span>
              <small class="text-primary">+10 pts</small>
            </div>
            <h5 class="card-title">Kit Frenos V-Brake</h5>
            <p class="card-text">Sistema completo de frenos para scooter</p>
            <div class="d-flex justify-content-between align-items-center">
              <strong class="h5 text-primary mb-0">$28.000</strong>
            </div>
            <a href="productos.html" class="stretched-link" aria-label="Ir a Productos: Kit Frenos V-Brake"></a>
          </div>
        </div>
      </article>
    </div>
    </section>
  </main>

  <!-- Footer con respaldo -->
  <footer class="custom20-footer mt-5">
    <div class="container text-center">
      <p class="mb-2">
        <i class="bi bi-whatsapp text-success"></i> 
        <a href="https://wa.me/56912345678?text=Hola,%20necesito%20consultar%20sobre%20repuestos%20para%20mi%20scooter" class="text-decoration-none">
          Consultas por WhatsApp
        </a>
      </p>
      <p class="mb-0">© <span id="yearNow"></span> Custom20. Todos los derechos reservados.</p>
    </div>
  </footer>
  
  <div id="footer-container" style="display: none;"></div>

  <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
  <script src="assets/js/auth.js"></script>
  <script src="assets/js/layout.js"></script>
  <script>
    // Sistema ScooterPoints básico
    class ScooterPointsSystem {
      constructor() {
        this.userPoints = parseInt(localStorage.getItem('scooterPoints') || '0');
        this.userTier = this.calculateTier(this.userPoints);
        this.updateDisplay();
      }
      
      calculateTier(points) {
        if (points >= 1000) return "Pro";
        if (points >= 500) return "Expert";
        if (points >= 200) return "Advanced";
        return "Beginner";
      }
      
      
      updateDisplay() {
        const tierElement = document.getElementById('user-tier');
        const pointsElement = document.getElementById('user-points');
        if (tierElement) tierElement.textContent = this.userTier;
        if (pointsElement) pointsElement.textContent = this.userPoints;
      }
      
      showPointsNotification(points) {
        // Crear notificación toast
        const toast = document.createElement('div');
        toast.className = 'toast align-items-center text-white border-0 position-fixed';
        toast.style.cssText = 'top: 20px; right: 20px; z-index: 9999; background: linear-gradient(135deg, #FF6B35, #2E86AB);';
        toast.innerHTML = `
          <div class="d-flex">
            <div class="toast-body">
              <i class="bi bi-star-fill"></i> +${points} ScooterPoints ganados!
            </div>
            <button type="button" class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast"></button>
          </div>
        `;
        
        document.body.appendChild(toast);
        const bsToast = new bootstrap.Toast(toast);
        bsToast.show();
        
        // Remover después de que se oculte
        toast.addEventListener('hidden.bs.toast', () => {
          toast.remove();
        });
      }
    }

    // Inicializar sistema de puntos
    let scooterPoints = new ScooterPointsSystem();

    // Función para agregar productos al carrito rápidamente
    function addToCartQuick(productCode) {
      // Simular agregar al carrito (aquí usarías tu lógica existente)
      let cart = JSON.parse(localStorage.getItem('APP_CART') || '[]');
      
      // Productos de ejemplo
      const products = {
        'BAT001': { id: 'BAT001', name: 'Batería Litio 36V 10Ah', price: 185000, points: 185 },
        'CAR001': { id: 'CAR001', name: 'Cargador 42V 2A', price: 35000, points: 35 },
        'FRE001': { id: 'FRE001', name: 'Kit Frenos V-Brake', price: 28000, points: 28 }
      };
      
      const product = products[productCode];
      if (product) {
        // Verificar si ya existe en el carrito
        const existingItem = cart.find(item => item.id === product.id);
        if (existingItem) {
          existingItem.qty += 1;
        } else {
          cart.push({ ...product, qty: 1 });
        }
        
        localStorage.setItem('APP_CART', JSON.stringify(cart));
        updateCartCount();
        
       

        
        // Mostrar notificación de éxito
        const toast = document.createElement('div');
        toast.className = 'toast align-items-center text-white bg-success border-0 position-fixed';
        toast.style.cssText = 'top: 20px; right: 20px; z-index: 9999;';
        toast.innerHTML = `
          <div class="d-flex">
            <div class="toast-body">
              <i class="bi bi-check-circle"></i> ${product.name} agregado al carrito
            </div>
            <button type="button" class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast"></button>
          </div>
        `;
        
        document.body.appendChild(toast);
        const bsToast = new bootstrap.Toast(toast);
        bsToast.show();
        
        toast.addEventListener('hidden.bs.toast', () => {
          toast.remove();
        });
      }
    }

    // Función para actualizar contador del carrito
    function updateCartCount() {
      const cart = JSON.parse(localStorage.getItem('APP_CART') || '[]');
      const totalItems = cart.reduce((sum, item) => sum + (item.qty || 1), 0);
      
      const cartCountEl = document.getElementById('cartCount');
      if (cartCountEl) {
        cartCountEl.textContent = totalItems;
      }
    }

    $(function() {
      // Inicializar año
      document.getElementById("yearNow").textContent = new Date().getFullYear();
      
      // Inicializar contador del carrito
      updateCartCount();
      
      // Manejar visibilidad del login y ScooterPoints
      function updateNavbarAuth() {
        console.log('Actualizando navbar de autenticación...');
        
        // Fallback si AuthStore no está disponible
        let user = null;
        if (window.AuthStore && window.AuthStore.getCurrentUser) {
          user = window.AuthStore.getCurrentUser();
        } else {
          // Fallback directo desde localStorage
          try {
            const userData = localStorage.getItem('APP_CURRENT_USER');
            if (userData) {
              user = JSON.parse(userData);
              console.log('Usuario obtenido desde localStorage:', user);
            }
          } catch (e) {
            console.error('Error al obtener usuario desde localStorage:', e);
          }
        }
        
        const loginSection = document.getElementById('loginSection');
        const userSection = document.getElementById('userSection');
        const scooterPointsSection = document.getElementById('scooterPointsSection');
        
        console.log('Usuario actual:', user);
        
        if (user) {
          // Usuario logueado
          console.log('Usuario logueado, actualizando navbar...');
          if (loginSection) loginSection.classList.add('d-none');
          if (userSection) {
            userSection.classList.remove('d-none');
            const userNameEl = document.getElementById('navUserName');
            if (userNameEl) {
              userNameEl.textContent = user.name;
              console.log('Nombre de usuario actualizado:', user.name);
            }
          }
          
          // Mostrar ScooterPoints
          if (scooterPointsSection) {
            scooterPointsSection.classList.remove('d-none');
          }
          
          // Mostrar enlaces de admin si es admin
          if (user.role === 'admin') {
            const adminLinks = document.querySelectorAll('.admin-only');
            adminLinks.forEach(link => link.classList.remove('d-none'));
            console.log('Enlaces de admin mostrados');
          }
        } else {
          // Usuario no logueado
          console.log('Usuario no logueado, mostrando login...');
          if (loginSection) loginSection.classList.remove('d-none');
          if (userSection) userSection.classList.add('d-none');
          if (scooterPointsSection) scooterPointsSection.classList.add('d-none');
        }
      }
      
      // Ejecutar inmediatamente
      updateNavbarAuth();
      
      // También ejecutar después de un pequeño delay para asegurar que AuthStore esté cargado
      setTimeout(updateNavbarAuth, 100);
      
      // Escuchar eventos de autenticación
      window.addEventListener('auth:login', updateNavbarAuth);
      window.addEventListener('auth:logout', updateNavbarAuth);
      
      // Botón de logout
      document.getElementById('btnLogout')?.addEventListener('click', function(e) {
        e.preventDefault();
        console.log('Cerrando sesión...');
        
        // Usar función global de logout
        if (window.globalLogout) {
          window.globalLogout();
        } else {
          // Fallback si la función global no está disponible
          localStorage.removeItem('APP_CURRENT_USER');
          updateNavbarAuth();
          window.location.href = 'index.html';
        }
      });
      
      // Inicializar navbar logic
      if (window.Layout && window.Layout.initNavbarLogic) {
        window.Layout.initNavbarLogic();
      }
      
      // Intentar cargar partials (fallback)
      if (window.Layout && window.Layout.loadPartials) {
        Layout.loadPartials();
      }
    });
  </script>
</body>
</html>