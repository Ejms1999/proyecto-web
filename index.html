<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8">
  <title>Custom20 | Inicio</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <!-- Bootstrap -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css" rel="stylesheet">
  <!-- Custom20 Styles -->
  <link href="assets/css/styles.css" rel="stylesheet">
</head>
<body>
  <!-- Navbar con respaldo -->
  <nav class="navbar navbar-expand-lg bg-white border-bottom sticky-top">
    <div class="container">
      <a class="navbar-brand fw-bold" href="index.html"><i class="bi bi-battery-charging"></i> Custom20.cl</a>
      
      <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#mainNav">
        <span class="navbar-toggler-icon"></span>
      </button>

      <div class="collapse navbar-collapse" id="mainNav">
        <ul class="navbar-nav me-auto">
          <li class="nav-item admin-only d-none"><a class="nav-link" href="admin.html">Admin Productos</a></li>
          <li class="nav-item admin-only d-none"><a class="nav-link" href="admin_usuarios.html">Admin Usuarios</a></li>
          <li class="nav-item"><a class="nav-link" href="index.html"><i class="bi bi-house"></i> Inicio</a></li>
          <li class="nav-item"><a class="nav-link" href="productos.html">Repuestos</a></li>
          <li class="nav-item"><a class="nav-link" href="servicios.html">Servicios</a></li>
          <li class="nav-item"><a class="nav-link" href="preguntas.html">Preguntas</a></li>
          <li class="nav-item"><a class="nav-link" href="contacto.html">Contacto</a></li>
        </ul>

        <ul class="navbar-nav ms-auto">
          <li class="nav-item me-3">
            <a class="nav-link position-relative" href="carrito.html">
              🛒 Carrito
              <span id="cartCount" class="badge bg-primary text-white position-absolute top-0 start-100 translate-middle">0</span>
            </a>
          </li>
          <li class="nav-item" id="loginSection">
            <a class="btn btn-outline-primary btn-sm" href="login.html">
              <i class="bi bi-box-arrow-in-right me-1"></i>Iniciar Sesión
            </a>
          </li>
          <li class="nav-item d-none" id="userSection">
            <span class="navbar-text me-2" id="navUserName">Invitado</span>
            <a class="btn btn-outline-secondary btn-sm" href="#" id="btnLogout">
              <i class="bi bi-box-arrow-right me-1"></i>Salir
            </a>
          </li>
        </ul>
      </div>
    </div>
  </nav>
  
  <div id="navbar-container" style="display: none;"></div>



<header class="bg-primary text-white text-center py-5">
  <div class="container">
    <h1 class="fw-bold">Reparación, repuestos, accesorios y baterías de litio a medida</h1>
    <p class="lead">Scooters eléctricos, bicicletas eléctricas y proyectos eléctricos</p>
    <div class="d-flex justify-content-center gap-2">
      <a href="productos.html" class="btn btn-light text-primary"><i class="bi bi-bag me-1"></i>Ver repuestos</a>
      <a href="servicios.html" class="btn btn-outline-light"><i class="bi bi-tools me-1"></i>Servicios</a>
    </div>
  </div>
</header>


<main class="container my-5">
  <section class="welcome-section">
    <header>
      <h2 class="h4 mb-3">Bienvenido a Custom20</h2>
    </header>
    <article class="about-content">
      <p class="lead">🔋 Con más de 6 años de experiencia en electromovilidad nos respaldan.</p>
      <p>Ofrecemos reparación y fabricación de baterías de litio a medida, mantención y diagnóstico eléctrico de scooters y bicicletas, además de la venta de repuestos y accesorios de calidad.</p>
      <p>Nuestro compromiso es brindarte seguridad, rendimiento y confianza en cada servicio, con garantía y soporte personalizado.</p>
    </article>
  </section>

  <section class="services-preview mt-5">
    <header>
      <h2 class="h4 mb-4">Nuestros Servicios</h2>
    </header>
    <div class="row g-4">
      <article class="col-md-4">
        <div class="service-card">
          <h3 class="h5">
            <i class="bi bi-battery-half icon"></i>
            Reparación de Baterías
          </h3>
          <p>Diagnóstico y reparación de baterías de litio de todo tipo de dispositivos eléctricos.</p>
        </div>
      </article>
      <article class="col-md-4">
        <div class="service-card">
          <h3 class="h5">
            <i class="bi bi-gear icon"></i>
            Fabricación a Medida
          </h3>
          <p>Armado de packs personalizados según necesidades de voltaje, amperaje y medidas.</p>
        </div>
      </article>
      <article class="col-md-4">
        <div class="service-card">
          <h3 class="h5">
            <i class="bi bi-lightning icon"></i>
            Diagnóstico Eléctrico
          </h3>
          <p>Servicio de fallas eléctricas de bicicletas, motos o scooters eléctricos.</p>
        </div>
      </article>
    </div>
  </section>
</main>

  <!-- Footer con respaldo -->
  <footer class="custom20-footer mt-5">
    <div class="container text-center">
      <p class="mb-0">© <span id="yearNow"></span> Custom20. Todos los derechos reservados.</p>
    </div>
  </footer>
  
  <div id="footer-container" style="display: none;"></div>

  <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
  <script src="assets/js/auth.js"></script>
  <script src="assets/js/layout.js"></script>
  <script>
    // Función para actualizar contador del carrito
    function updateCartCount() {
      const cart = JSON.parse(localStorage.getItem('APP_CART') || '[]');
      const totalItems = cart.reduce((sum, item) => sum + (item.qty || 1), 0);
      
      const cartCountEl = document.getElementById('cartCount');
      if (cartCountEl) {
        cartCountEl.textContent = totalItems;
      }
    }

    $(function() {
      // Inicializar año
      document.getElementById("yearNow").textContent = new Date().getFullYear();
      
      // Inicializar contador del carrito
      updateCartCount();
      
      // Manejar visibilidad del login
      function updateNavbarAuth() {
        console.log('Actualizando navbar de autenticación...');
        
        // Fallback si AuthStore no está disponible
        let user = null;
        if (window.AuthStore && window.AuthStore.getCurrentUser) {
          user = window.AuthStore.getCurrentUser();
        } else {
          // Fallback directo desde localStorage
          try {
            const userData = localStorage.getItem('APP_CURRENT_USER');
            if (userData) {
              user = JSON.parse(userData);
              console.log('Usuario obtenido desde localStorage:', user);
            }
          } catch (e) {
            console.error('Error al obtener usuario desde localStorage:', e);
          }
        }
        
        const loginSection = document.getElementById('loginSection');
        const userSection = document.getElementById('userSection');
        
        console.log('Usuario actual:', user);
        console.log('loginSection:', loginSection);
        console.log('userSection:', userSection);
        
        if (user) {
          // Usuario logueado
          console.log('Usuario logueado, actualizando navbar...');
          if (loginSection) loginSection.classList.add('d-none');
          if (userSection) {
            userSection.classList.remove('d-none');
            const userNameEl = document.getElementById('navUserName');
            if (userNameEl) {
              userNameEl.textContent = user.name;
              console.log('Nombre de usuario actualizado:', user.name);
            }
          }
          
          // Mostrar enlaces de admin si es admin
          if (user.role === 'admin') {
            const adminLinks = document.querySelectorAll('.admin-only');
            adminLinks.forEach(link => link.classList.remove('d-none'));
            console.log('Enlaces de admin mostrados');
          }
        } else {
          // Usuario no logueado
          console.log('Usuario no logueado, mostrando login...');
          if (loginSection) loginSection.classList.remove('d-none');
          if (userSection) userSection.classList.add('d-none');
        }
      }
      
      // Ejecutar inmediatamente
      updateNavbarAuth();
      
      // También ejecutar después de un pequeño delay para asegurar que AuthStore esté cargado
      setTimeout(updateNavbarAuth, 100);
      
      // Escuchar eventos de autenticación
      window.addEventListener('auth:login', updateNavbarAuth);
      window.addEventListener('auth:logout', updateNavbarAuth);
      
      // Botón de logout
      document.getElementById('btnLogout')?.addEventListener('click', function(e) {
        e.preventDefault();
        console.log('Cerrando sesión...');
        
        // Usar función global de logout
        if (window.globalLogout) {
          window.globalLogout();
        } else {
          // Fallback si la función global no está disponible
          localStorage.removeItem('APP_CURRENT_USER');
          updateNavbarAuth();
          window.location.href = 'index.html';
        }
      });
      
      // Inicializar navbar logic
      if (window.Layout && window.Layout.initNavbarLogic) {
        window.Layout.initNavbarLogic();
      }
      
      // Intentar cargar partials (fallback)
      if (window.Layout && window.Layout.loadPartials) {
        Layout.loadPartials();
      }
    });
  </script>
</body>
</html>
